# Yee Note App 功能设计文档

## 1. 文档目的

本文档详细描述Yee Note App的功能实现设计，包括前后端架构、API接口设计、数据模型设计、安全设计等，为开发团队提供明确的技术实现指导。

## 2. 系统架构

### 2.1 前端架构

- **框架选择**：Vue.js 3.x + Vite
- **状态管理**：Pinia
- **路由管理**：Vue Router
- **UI组件库**：Tailwind CSS
- **HTTP请求**：Axios
- **本地存储**：localStorage + IndexedDB

### 2.2 后端架构

- **语言选择**：Node.js
- **框架**：Express.js
- **数据库**：MongoDB
- **认证**：JWT (JSON Web Token)
- **文件存储**：云存储服务
- **API设计**：RESTful

## 3. 数据库设计

### 3.1 用户表 (users)

```javascript
{
  _id: ObjectId,
  email: String,
  phone: String,
  password: String, // 加密存储
  nickname: String,
  avatar: String,
  registerTime: Date,
  lastLoginTime: Date,
  storageUsed: Number, // 已用存储空间（字节）
  storageLimit: Number, // 总存储空间（字节）
  settings: {
    theme: String, // 'light' | 'dark'
    fontSize: Number,
    autoSync: Boolean,
    syncFrequency: Number, // 同步频率（小时）
    appLock: Boolean,
    lockPattern: String // 加密存储
  }
}
```

### 3.2 笔记表 (notes)

```javascript
{
  _id: ObjectId,
  userId: ObjectId, // 关联用户表
  title: String,
  content: String,
  categoryId: ObjectId, // 关联分类表
  tags: [ObjectId], // 关联标签表
  images: [String], // 图片URL数组
  createTime: Date,
  updateTime: Date,
  isDeleted: Boolean // 软删除标志
}
```

### 3.3 分类表 (categories)

```javascript
{
  _id: ObjectId,
  userId: ObjectId, // 关联用户表
  name: String,
  color: String, // 颜色代码
  createTime: Date,
  order: Number // 排序字段
}
```

### 3.4 标签表 (tags)

```javascript
{
  _id: ObjectId,
  userId: ObjectId, // 关联用户表
  name: String,
  createTime: Date
}
```

### 3.5 同步记录表 (sync_records)

```javascript
{
  _id: ObjectId,
  userId: ObjectId, // 关联用户表
  syncTime: Date,
  status: String, // 'success' | 'failed'
  errorMessage: String,
  syncSize: Number // 同步数据大小
}
```

### 3.6 搜索历史表 (search_history)

```javascript
{
  _id: ObjectId,
  userId: ObjectId, // 关联用户表
  keyword: String,
  searchTime: Date
}
```

## 4. API接口设计

### 4.1 用户认证接口

#### 4.1.1 用户登录
- **URL**: `/api/auth/login`
- **方法**: `POST`
- **请求体**:
  ```json
  {
    "username": "user@example.com", // 邮箱或手机号
    "password": "password123"
  }
  ```
- **响应**:
  ```json
  {
    "code": 200,
    "data": {
      "token": "jwt_token",
      "user": {
        "id": "user_id",
        "email": "user@example.com",
        "nickname": "用户名"
      }
    }
  }
  ```

#### 4.1.2 用户注册
- **URL**: `/api/auth/register`
- **方法**: `POST`
- **请求体**:
  ```json
  {
    "email": "user@example.com",
    "phone": "13800138000",
    "verificationCode": "123456",
    "password": "password123"
  }
  ```
- **响应**:
  ```json
  {
    "code": 200,
    "data": {
      "token": "jwt_token",
      "user": {
        "id": "user_id",
        "email": "user@example.com"
      }
    }
  }
  ```

#### 4.1.3 获取验证码
- **URL**: `/api/auth/send-code`
- **方法**: `POST`
- **请求体**:
  ```json
  {
    "phone": "13800138000"
  }
  ```
- **响应**:
  ```json
  {
    "code": 200,
    "message": "验证码已发送"
  }
  ```

### 4.2 笔记管理接口

#### 4.2.1 获取笔记列表
- **URL**: `/api/notes`
- **方法**: `GET`
- **查询参数**:
  - `page`: 页码
  - `pageSize`: 每页数量
  - `categoryId`: 分类ID（可选）
  - `keyword`: 搜索关键词（可选）
  - `startDate`: 开始日期（可选）
  - `endDate`: 结束日期（可选）
- **响应**:
  ```json
  {
    "code": 200,
    "data": {
      "list": [
        {
          "id": "note_id",
          "title": "笔记标题",
          "content": "笔记内容...",
          "category": {
            "id": "category_id",
            "name": "分类名称",
            "color": "#4ade80"
          },
          "tags": [
            { "id": "tag_id", "name": "标签名称" }
          ],
          "createTime": "2024-01-01T12:00:00Z",
          "updateTime": "2024-01-01T12:00:00Z"
        }
      ],
      "total": 100,
      "page": 1,
      "pageSize": 10
    }
  }
  ```

#### 4.2.2 创建笔记
- **URL**: `/api/notes`
- **方法**: `POST`
- **请求体**:
  ```json
  {
    "title": "新笔记",
    "content": "笔记内容",
    "categoryId": "category_id",
    "tags": ["tag_id1", "tag_id2"]
  }
  ```
- **响应**:
  ```json
  {
    "code": 200,
    "data": {
      "id": "note_id",
      "title": "新笔记",
      "createTime": "2024-01-01T12:00:00Z"
    }
  }
  ```

#### 4.2.3 更新笔记
- **URL**: `/api/notes/:id`
- **方法**: `PUT`
- **请求体**:
  ```json
  {
    "title": "更新的标题",
    "content": "更新的内容",
    "categoryId": "category_id",
    "tags": ["tag_id1", "tag_id2"]
  }
  ```
- **响应**:
  ```json
  {
    "code": 200,
    "data": {
      "id": "note_id",
      "updateTime": "2024-01-01T13:00:00Z"
    }
  }
  ```

#### 4.2.4 删除笔记
- **URL**: `/api/notes/:id`
- **方法**: `DELETE`
- **响应**:
  ```json
  {
    "code": 200,
    "message": "删除成功"
  }
  ```

### 4.3 分类管理接口

#### 4.3.1 获取分类列表
- **URL**: `/api/categories`
- **方法**: `GET`
- **响应**:
  ```json
  {
    "code": 200,
    "data": [
      {
        "id": "category_id",
        "name": "工作",
        "color": "#4299e1",
        "noteCount": 12,
        "order": 1
      }
    ]
  }
  ```

#### 4.3.2 创建分类
- **URL**: `/api/categories`
- **方法**: `POST`
- **请求体**:
  ```json
  {
    "name": "新分类",
    "color": "#4ade80"
  }
  ```
- **响应**:
  ```json
  {
    "code": 200,
    "data": {
      "id": "category_id",
      "name": "新分类",
      "color": "#4ade80"
    }
  }
  ```

### 4.4 标签管理接口

#### 4.4.1 获取标签列表
- **URL**: `/api/tags`
- **方法**: `GET`
- **响应**:
  ```json
  {
    "code": 200,
    "data": [
      {
        "id": "tag_id",
        "name": "会议",
        "createTime": "2024-01-01T12:00:00Z"
      }
    ]
  }
  ```

### 4.5 同步管理接口

#### 4.5.1 获取同步状态
- **URL**: `/api/sync/status`
- **方法**: `GET`
- **响应**:
  ```json
  {
    "code": 200,
    "data": {
      "storageUsed": 268435456, // 256MB
      "storageLimit": 5368709120, // 5GB
      "lastSyncTime": "2024-01-01T08:30:00Z",
      "syncStatus": "connected"
    }
  }
  ```

#### 4.5.2 手动同步
- **URL**: `/api/sync/now`
- **方法**: `POST`
- **响应**:
  ```json
  {
    "code": 200,
    "data": {
      "syncTime": "2024-01-01T14:00:00Z",
      "status": "success",
      "syncSize": 10240 // 10KB
    }
  }
  ```

### 4.6 用户设置接口

#### 4.6.1 更新用户设置
- **URL**: `/api/user/settings`
- **方法**: `PUT`
- **请求体**:
  ```json
  {
    "theme": "dark",
    "fontSize": 16,
    "autoSync": true,
    "syncFrequency": 6
  }
  ```
- **响应**:
  ```json
  {
    "code": 200,
    "data": {
      "settings": {
        "theme": "dark",
        "fontSize": 16,
        "autoSync": true,
        "syncFrequency": 6
      }
    }
  }
  ```

## 5. 前端页面设计

### 5.1 页面结构

- **App.vue**: 主应用组件
- **views/**: 页面组件
  - **Home.vue**: 首页
  - **NoteEditor.vue**: 笔记编辑器
  - **CategoryManager.vue**: 分类管理
  - **Search.vue**: 搜索页面
  - **Settings.vue**: 设置页面
  - **Login.vue**: 登录页面
  - **Register.vue**: 注册页面
  - **CloudSync.vue**: 同步设置页面
- **components/**: 通用组件
  - **NoteCard.vue**: 笔记卡片组件
  - **CategoryItem.vue**: 分类项组件
  - **TagItem.vue**: 标签组件
  - **EditorToolbar.vue**: 编辑器工具栏
  - **BottomNav.vue**: 底部导航栏

### 5.2 状态管理设计

#### 5.2.1 用户状态 (userStore)
```javascript
{
  userInfo: {},
  token: '',
  isLogin: false,
  // Actions
  login(),
  logout(),
  updateUserInfo()
}
```

#### 5.2.2 笔记状态 (noteStore)
```javascript
{
  notes: [],
  currentNote: null,
  loading: false,
  // Actions
  fetchNotes(),
  createNote(),
  updateNote(),
  deleteNote(),
  getNoteById()
}
```

#### 5.2.3 分类状态 (categoryStore)
```javascript
{
  categories: [],
  // Actions
  fetchCategories(),
  createCategory(),
  updateCategory(),
  deleteCategory()
}
```

## 6. 安全设计

### 6.1 认证与授权
- 使用JWT进行身份认证
- API接口权限控制
- 密码加密存储（bcrypt）

### 6.2 数据安全
- HTTPS传输
- 敏感数据加密存储
- SQL注入防护
- XSS防护

### 6.3 用户隐私
- 遵循用户协议和隐私政策
- 数据匿名化处理
- 权限最小化原则

## 7. 性能优化

### 7.1 前端优化
- 代码分割
- 懒加载
- 缓存策略
- 图片压缩和优化

### 7.2 后端优化
- 数据库索引优化
- 查询性能优化
- 缓存机制（Redis）
- 负载均衡

## 8. 部署方案

### 8.1 前端部署
- Nginx静态资源服务
- CDN加速
- 容器化部署（Docker）

### 8.2 后端部署
- Node.js应用部署
- MongoDB数据库部署
- 容器化部署（Docker）
- 微服务架构（可选）

## 9. 测试方案

### 9.1 单元测试
- Jest框架
- 组件测试
- API测试

### 9.2 集成测试
- 前后端集成测试
- 数据库操作测试

### 9.3 性能测试
- 负载测试
- 响应时间测试

## 10. 版本控制

- Git分支管理
- 语义化版本控制
- 代码审查流程

## 11. 开发规范

### 11.1 前端规范
- Vue.js编码规范
- ESLint配置
- 代码风格统一

### 11.2 后端规范
- Node.js编码规范
- API命名规范
- 错误处理规范

### 11.3 文档规范
- API文档规范
- 代码注释规范
- 项目文档更新机制

## 12. 风险评估与应对

### 12.1 技术风险
- 数据同步冲突
- 大文件上传下载
- 性能瓶颈

### 12.2 安全风险
- 账号泄露
- 数据丢失
- 恶意攻击

### 12.3 应对策略
- 定期数据备份
- 监控系统
- 应急预案