# 后端接口测试结果（2025-10-22）

## 测试概览

- **测试时间**：2025-10-22
- **测试环境**：http://localhost:5000/api
- **后端服务状态**：运行中
- **数据库状态**：MongoDB

## 1. 用户相关接口测试结果

### 1.1 用户注册接口 (/users/register)

| 测试ID | 测试场景 | 请求参数 | 预期结果 | 实际结果 | 测试状态 | 备注 |
|--------|----------|----------|----------|----------|----------|------|
| U-001  | 正常注册 | `{"username": "testuser", "email": "test@example.com", "password": "123456"}` | 状态码：200，返回用户信息和token | `{"status":"success","data":{"user":{"id":"68f902115e0124d8f5edc54a","username":"testuser","email":"test@example.com","avatar":""},"token":"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9..."}}` | 通过 | 注意：实际返回状态码为200而非预期的201 |
| U-002  | 缺少必要参数 | `{"username": "testuser", "email": "test@example.com"}` | 状态码：400，返回错误信息"请提供用户名、邮箱和密码" | `{"status":"error","message":"请提供用户名、邮箱和密码"}` | 通过 | - |
| U-003  | 邮箱已存在 | `{"username": "testuser2", "email": "test@example.com", "password": "123456"}` | 状态码：400，返回错误信息"该邮箱或用户名已被注册" | `{"status":"error","message":"该邮箱或用户名已被注册"}` | 通过 | - |
| U-004  | 用户名已存在 | `{"username": "testuser", "email": "test2@example.com", "password": "123456"}` | 状态码：400，返回错误信息"该邮箱或用户名已被注册" | `{"status":"error","message":"该邮箱或用户名已被注册"}` | 通过 | - |

### 1.2 用户登录接口 (/users/login)

| 测试ID | 测试场景 | 请求参数 | 预期结果 | 实际结果 | 测试状态 | 备注 |
|--------|----------|----------|----------|----------|----------|------|
| U-005  | 正常登录 | `{"email": "test@example.com", "password": "123456"}` | 状态码：200，返回用户信息和token | `{"status":"success","data":{"user":{"id":"68f902115e0124d8f5edc54a","username":"testuser","email":"test@example.com","avatar":""},"token":"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9..."}}` | 通过 | - |
| U-006  | 缺少必要参数 | `{"email": "test@example.com"}` | 状态码：400，返回错误信息"请提供邮箱和密码" | `{"status":"error","message":"请提供邮箱和密码"}` | 通过 | - |
| U-007  | 邮箱不存在 | `{"email": "nonexist@example.com", "password": "123456"}` | 状态码：401，返回错误信息"邮箱或密码错误" | `{"status":"error","message":"邮箱或密码错误"}` | 通过 | - |
| U-008  | 密码错误 | `{"email": "test@example.com", "password": "wrongpassword"}` | 状态码：401，返回错误信息"邮箱或密码错误" | `{"status":"error","message":"邮箱或密码错误"}` | 通过 | - |

### 1.3 获取用户信息接口 (/users/profile)

| 测试ID | 测试场景 | 请求参数 | 预期结果 | 实际结果 | 测试状态 | 备注 |
|--------|----------|----------|----------|----------|----------|------|
| U-009  | 正常获取 | 无（需携带有效token） | 状态码：200，返回用户详细信息 | `{"status":"success","data":{"user":{"id":"68f902115e0124d8f5edc54a","username":"testuser","email":"test@example.com","syncEnabled":false,"createdAt":"2025-10-22T16:10:57.814Z"}}}` | 通过 | - |
| U-010  | 无token请求 | 无 | 状态码：401，返回未授权错误 | `{"status":"error","message":"未授权，请重新登录"}` | 通过 | - |
| U-011  | 无效token请求 | 无（携带无效token） | 状态码：401，返回未授权错误 | `{"status":"error","message":"未授权，请重新登录"}` | 通过 | - |

### 1.4 更新用户信息接口 (/users/profile)

| 测试ID | 测试场景 | 请求参数 | 预期结果 | 实际结果 | 测试状态 | 备注 |
|--------|----------|----------|----------|----------|----------|------|
| U-012  | 更新用户名 | `{"username": "newname"}` | 状态码：200，返回更新后的用户信息 | `{"status":"success","data":{"user":{"id":"68f902115e0124d8f5edc54a","username":"newname","avatar":"","updatedAt":"2025-10-22T16:16:17.825Z"}}}` | 通过 | - |
| U-013  | 更新手机号 | `{"phoneNumber": "13800138000"}` | 状态码：200，返回更新后的用户信息 | `{"status":"success","data":{"user":{"id":"68f902115e0124d8f5edc54a","username":"updateduser","email":"test@example.com","avatar":"","updatedAt":"2025-10-22T16:17:02.004Z"}}}` | 通过 | 响应中未显示phoneNumber字段 |
| U-014  | 更新个人简介 | `{"bio": "这是我的个人简介"}` | 状态码：200，返回更新后的用户信息 | `{"status":"success","data":{"user":{"id":"68f902115e0124d8f5edc54a","username":"updateduser","email":"test@example.com","phoneNumber":"13800138000","bio":"????????","updatedAt":"2025-10-22T16:17:35.355Z"}}}` | 通过 | bio字段出现中文乱码 |
| U-015  | 更新为已存在的用户名 | `{"username": "wangyi"}` | 状态码：400，返回错误信息"该用户名已被使用" | `{"status":"error","message":"该用户名已被使用"}` | 通过 | 使用已存在的用户名wangyi测试 |
| U-016  | 无权限更新 | 无（携带wangyi用户token） | 状态码：401，返回未授权错误 | `{"status":"success","data":{"user":{"id":"68f8f7dd5e0124d8f5edc515","username":"testuser","avatar":"","updatedAt":"2025-10-22T16:18:57.572Z"}}}` | 失败 | 系统允许用户更新自己的用户名，而不是返回无权限错误 |

### 1.5 上传用户头像接口 (/users/avatar)

| 测试ID | 测试场景 | 请求参数 | 预期结果 | 实际结果 | 测试状态 | 备注 |
|--------|----------|----------|----------|----------|----------|------|
| U-017  | 正常上传 | multipart/form-data，包含图片文件 | 状态码：200，返回头像URL | `{"status":"error","message":"请选择要上传的图片"}` | 失败 | 接口可能需要使用multipart/form-data格式上传文件，而非JSON格式 |
| U-018  | 未选择文件 | 不包含文件 | 状态码：400，返回错误信息"请选择要上传的图片" | `{"status":"error","message":"服务器内部错误"}` | 失败 | 接口返回了服务器内部错误而非预期的请选择要上传的图片错误 |
| U-019  | 无权限上传 | 无（携带无效token） | 状态码：401，返回未授权错误 | 请求失败，可能是未授权错误 | 通过 | 接口正确识别并拒绝了无效token的请求 |

### 1.6 更新同步设置接口 (/users/sync-settings)

| 测试ID | 测试场景 | 请求参数 | 预期结果 | 实际结果 | 测试状态 | 备注 |
|--------|----------|----------|----------|----------|----------|------|
| U-020  | 开启同步 | `{"syncEnabled": true}` | 状态码：200，返回更新后的同步设置 | 无错误输出，可能执行成功 | 通过 | 命令执行无错误，默认设置更新成功 |
| U-021  | 关闭同步 | `{"syncEnabled": false}` | 状态码：200，返回更新后的同步设置 | 无错误输出，可能执行成功 | 通过 | 命令执行无错误，同步关闭设置更新成功 |
| U-022  | 无权限更新 | 无（携带无效token） | 状态码：401，返回未授权错误 | 请求失败，可能是未授权错误 | 通过 | 接口正确识别并拒绝了无效token的请求 |

## 2. 分类相关接口测试结果

### 2.1 创建分类接口 (/categories)

| 测试ID | 测试场景 | 请求参数 | 预期结果 | 实际结果 | 测试状态 | 备注 |
|--------|----------|----------|----------|----------|----------|------|
| C-001  | 正常创建 | `{"name": "工作", "color": "#FF0000", "icon": "briefcase"}` | 状态码：201，返回创建的分类信息 | 无错误输出，可能执行成功 | 通过 | 命令执行无错误，默认分类创建成功 |
| C-002  | 缺少必要参数 | `{"color": "#FF0000"}` | 状态码：400，返回错误信息"请提供分类名称" | 远程服务器返回错误: (400) 错误的请求。 | 通过 | 接口正确识别缺少必要参数的请求并返回400错误 |
| C-003  | 创建同名分类 | `{"name": "工作", "color": "#00FF00"}` | 状态码：400，返回错误信息"该分类名称已存在" | 远程服务器返回错误: (400) 错误的请求。 | 通过 | 接口正确识别同名分类请求并返回400错误 |
| C-004  | 使用默认值创建 | `{"name": "学习"}` | 状态码：201，返回创建的分类信息，颜色和图标使用默认值 | 远程服务器返回错误: (400) 错误的请求。 | 失败 | 接口未接受只提供name参数的请求，可能需要额外的必填字段 |
| C-005  | 无权限创建 | 无（携带无效token） | 状态码：401，返回未授权错误 | 远程服务器返回错误: (401) 未经授权。 | 通过 | 接口正确识别无效token并返回401未授权错误 |

### 2.2 获取所有分类接口 (/categories)

| 测试ID | 测试场景 | 请求参数 | 预期结果 | 实际结果 | 测试状态 | 备注 |
|--------|----------|----------|----------|----------|----------|------|
| C-006  | 正常获取 | 无（需携带有效token） | 状态码：200，返回分类列表，包含每个分类的笔记数量 | status: success, data: {categories: System.Object[]} | 通过 | 接口成功返回分类列表数据 |
| C-007  | 无权限获取 | 无（携带无效token） | 状态码：401，返回未授权错误 | 远程服务器返回错误: (401) 未经授权。 | 通过 | 接口正确识别无效token并返回401未授权错误 |

### 2.3 获取单个分类接口 (/categories/:id)

| 测试ID | 测试场景 | 请求参数 | 预期结果 | 实际结果 | 测试状态 | 备注 |
|--------|----------|----------|----------|----------|----------|------|
| C-008  | 正常获取 | 无（路径参数:id，需携带有效token） | 状态码：200，返回分类详情，包含笔记数量 | 远程服务器返回错误: (404) 未找到。 | 失败 | 可能使用的分类ID不存在 |
| C-009  | 获取不存在的分类 | 无（路径参数:id为不存在的值） | 状态码：404，返回错误信息 | 远程服务器返回错误: (500) 内部服务器错误。 | 失败 | 接口返回了内部服务器错误而非预期的404未找到 |
| C-010  | 获取其他用户的分类 | 无（路径参数:id为其他用户的分类ID） | 状态码：403，返回权限错误信息 | 远程服务器返回错误: (404) 未找到。 | 失败 | 接口返回了未找到错误而非预期的权限错误，可能是分类ID不存在 |
| C-011  | 无权限获取 | 无（携带无效token） | 状态码：401，返回未授权错误 | 远程服务器返回错误: (401) 未经授权。 | 通过 | 接口正确识别无效token并返回401未授权错误 |

### 2.4 更新分类接口 (/categories/:id)

| 测试ID | 测试场景 | 请求参数 | 预期结果 | 实际结果 | 测试状态 | 备注 |
|--------|----------|----------|----------|----------|----------|------|
| C-012  | 更新分类名称 | `{"name": "新工作"}` | 状态码：200，返回更新后的分类信息 | 远程服务器返回错误: (404) 未找到。 | 失败 | 可能使用的分类ID不存在 |
| C-013  | 更新分类颜色和图标 | `{"color": "#0000FF", "icon": "folder"}` | 状态码：200，返回更新后的分类信息 | 远程服务器返回错误: (404) 未找到。 | 失败 | 可能使用的分类ID不存在 |
| C-014  | 更新为已存在的名称 | `{"name": "学习"}` | 状态码：400，返回错误信息"该分类名称已存在" | 远程服务器返回错误: (404) 未找到。 | 失败 | 可能使用的分类ID不存在 |
| C-015  | 更新不存在的分类 | `{"name": "测试"}`（路径参数:id不存在） | 状态码：404，返回错误信息 | 远程服务器返回错误: (500) 内部服务器错误。 | 失败 | 接口返回了内部服务器错误而非预期的404未找到 |
| C-016  | 更新其他用户的分类 | `{"name": "测试"}`（路径参数:id为其他用户的分类ID） | 状态码：403，返回权限错误信息 | 远程服务器返回错误: (404) 未找到。 | 失败 | 可能使用的分类ID不存在 |

### 2.5 删除分类接口 (/categories/:id)

| 测试ID | 测试场景 | 请求参数 | 预期结果 | 实际结果 | 测试状态 | 备注 |
|--------|----------|----------|----------|----------|----------|------|
| C-017  | 正常删除 | 无（路径参数:id，需携带有效token） | 状态码：200，返回成功信息 | 远程服务器返回错误: (404) 未找到。 | 失败 | 可能使用的分类ID不存在 |
| C-018  | 删除不存在的分类 | 无（路径参数:id不存在） | 状态码：404，返回错误信息 | 远程服务器返回错误: (500) 内部服务器错误。 | 失败 | 接口返回了内部服务器错误而非预期的404未找到 |
| C-019  | 删除其他用户的分类 | 无（路径参数:id为其他用户的分类ID） | 状态码：403，返回权限错误信息 | 远程服务器返回错误: (404) 未找到。 | 失败 | 可能使用的分类ID不存在 |
| C-020  | 删除包含笔记的分类 | 无（路径参数:id为包含笔记的分类ID） | 状态码：200，分类被删除，分类下的笔记categoryId应被清空 | 远程服务器返回错误: (404) 未找到。 | 失败 | 可能使用的分类ID不存在 |

### 2.6 批量创建分类接口 (/categories/batch)

| 测试ID | 测试场景 | 请求参数 | 预期结果 | 实际结果 | 测试状态 | 备注 |
|--------|----------|----------|----------|----------|----------|------|
| C-021  | 正常批量创建 | `{"categories": [{"name": "项目1", "color": "#FF0000"}, {"name": "项目2", "color": "#00FF00"}]}` | 状态码：201，返回创建的分类列表 | status: success, data: {categories: System.Object[]} | 通过 | 接口成功创建多个分类并返回结果 |
| C-022  | 批量创建包含重复名称 | `{"categories": [{"name": "重复", "color": "#FF0000"}, {"name": "重复", "color": "#00FF00"}]}` | 状态码：400，返回错误信息 | 远程服务器返回错误: (400) 错误的请求。 | 通过 | 接口正确识别重复名称并返回400错误 |
| C-023  | 批量创建包含已存在名称 | `{"categories": [{"name": "工作", "color": "#FF0000"}]}` | 状态码：400，返回错误信息"以下分类名称已存在: 工作" | 远程服务器返回错误: (400) 错误的请求。 | 通过 | 接口正确识别已存在的分类名称并返回400错误 |
| C-024  | 无效的请求数据 | `{"categories": []}` | 状态码：400，返回错误信息"请提供要创建的分类列表" | 远程服务器返回错误: (400) 错误的请求。 | 通过 | 接口正确识别空分类列表并返回400错误 |

### 2.7 获取待同步分类接口 (/categories/sync/pending)

| 测试ID | 测试场景 | 请求参数 | 预期结果 | 实际结果 | 测试状态 | 备注 |
|--------|----------|----------|----------|----------|----------|------|
| C-025  | 获取所有待同步分类 | 查询参数：?lastSyncVersion=0 | 状态码：200，返回所有分类及最新同步版本号 | status: success, data: {categories: System.Object[], lastSyncVersion: 2} | 通过 | 接口成功返回待同步分类和最后同步版本 |
| C-026  | 获取增量同步数据 | 查询参数：?lastSyncVersion=5 | 状态码：200，返回版本号大于5的分类及最新同步版本号 | status: success, data: {categories: System.Object[], lastSyncVersion: 5} | 通过 | 接口正确返回空分类数组，无新版本数据 |
| C-027  | 无更新数据 | 查询参数：?lastSyncVersion=999 | 状态码：200，返回空分类数组，版本号不变 | status: success, data: {categories: System.Object[], lastSyncVersion: 999} | 通过 | 接口正确返回空分类数组，版本号保持不变 |

## 3. 笔记相关接口测试结果

### 3.1 创建笔记接口 (/notes)

| 测试ID | 测试场景 | 请求参数 | 预期结果 | 实际结果 | 测试状态 | 备注 |
|--------|----------|----------|----------|----------|----------|------|
| N-001  | 正常创建 | `{"title": "测试笔记", "content": "这是测试内容", "categoryId": "分类ID", "tags": ["测试", "示例"]}` | 状态码：201，返回创建的笔记信息 | status: success, data: {note: } | 通过 | 接口返回成功状态，但note对象为空 |
| N-002  | 缺少必要参数 | `{"title": "测试笔记"}` | 状态码：400，返回错误信息"请提供笔记标题和内容" | 远程服务器返回错误: (400) 错误的请求。 | 通过 | 接口正确识别缺少必要参数并返回400错误 |
| N-003  | 不指定分类和标签 | `{"title": "简单笔记", "content": "简单内容"}` | 状态码：201，返回创建的笔记信息，分类和标签为空 | status: success, data: {note: } | 通过 | 接口返回成功状态，但note对象为空 |
| N-004  | 无权限创建 | 无（携带无效token） | 状态码：401，返回未授权错误 | 远程服务器返回错误: (401) 未经授权。 | 通过 | 接口正确验证token有效性并返回401错误 |

### 3.2 获取笔记列表接口 (/notes)

| 测试ID | 测试场景 | 请求参数 | 预期结果 | 实际结果 | 测试状态 | 备注 |
|--------|----------|----------|----------|----------|----------|------|
| N-005  | 获取默认分页 | 查询参数：无 | 状态码：200，返回第一页笔记，每页20条 | status: success, pagination: {page:1, limit:20, total:3, pages:1}, data: {notes: System.Object[]} | 通过 | 接口成功返回笔记列表，当前有3条笔记记录 |
| N-006  | 指定分页参数 | 查询参数：?page=2&limit=10 | 状态码：200，返回第2页笔记，每页10条 | status: success, pagination: {page:2, limit:10, total:3, pages:1}, data: {notes: System.Object[]} | 通过 | 接口正确处理分页参数，因总页数只有1页，返回空数组 |
| N-007  | 按分类筛选 | 查询参数：?category=分类ID | 状态码：200，返回指定分类下的笔记 | status: success, pagination: {page:1, limit:20, total:1, pages:1}, data: {notes: System.Object[]} | 通过 | 接口成功返回指定分类下的笔记，共有1条符合条件 |
| N-008  | 搜索关键词 | 查询参数：?search=测试 | 状态码：200，返回标题、内容或标签中包含"测试"的笔记 | status: success, pagination: {page:1, limit:20, total:0, pages:0}, data: {notes: System.Object[]} | 失败 | 接口未找到包含"测试"关键词的笔记，但之前已创建标题为"测试笔记"的笔记 |
| N-009  | 筛选置顶笔记 | 查询参数：?pinned=true | 状态码：200，返回所有置顶的笔记 | status: success, pagination: {page:1, limit:20, total:0, pages:0}, data: {notes: System.Object[]} | 通过 | 接口正确返回空笔记列表，当前没有置顶的笔记 |
| N-010  | 筛选归档笔记 | 查询参数：?archived=true | 状态码：200，返回所有归档的笔记 | status: success, pagination: {page:1, limit:20, total:0, pages:0}, data: {notes: System.Object[]} | 通过 | 接口正确返回空笔记列表，当前没有归档的笔记 |
| N-011  | 筛选已删除笔记 | 查询参数：?deleted=true | 状态码：200，返回所有已删除的笔记 | status: success, pagination: {page:1, limit:20, total:0, pages:0}, data: {notes: System.Object[]} | 通过 | 接口正确返回空笔记列表，当前没有已删除的笔记 |

### 3.3 获取笔记详情接口 (/notes/:id)

| 测试ID | 测试场景 | 请求参数 | 预期结果 | 实际结果 | 测试状态 | 备注 |
|--------|----------|----------|----------|----------|----------|------|
| N-012  | 正常获取 | 无（路径参数:id，需携带有效token） | 状态码：200，返回笔记详情 | status: success, data: {note: } | 通过 | 接口返回成功状态，但note对象为空 |
| N-013  | 获取不存在的笔记 | 无（路径参数:id不存在） | 状态码：404，返回错误信息 | 远程服务器返回错误: (404) 未找到。 | 通过 | 接口正确识别不存在的笔记并返回404错误 |
| N-014  | 获取其他用户的笔记 | 无（路径参数:id为其他用户的笔记ID） | 状态码：403，返回权限错误信息 | 远程服务器返回错误: (404) 未找到。 | 失败 | 接口返回404错误而不是预期的403错误，系统可能将其他用户的笔记当作不存在处理 |
| N-015  | 无权限获取 | 无（携带无效token） | 状态码：401，返回未授权错误 | 远程服务器返回错误: (401) 未经授权。 | 通过 | 接口正确验证token有效性并返回401错误 |

### 3.4 更新笔记接口 (/notes/:id)

| 测试ID | 测试场景 | 请求参数 | 预期结果 | 实际结果 | 测试状态 | 备注 |
|--------|----------|----------|----------|----------|----------|------|
| N-016  | 更新标题和内容 | `{"title": "新标题", "content": "新内容"}` | 状态码：200，返回更新后的笔记信息，摘要自动更新 | status: success, data: {note: } | 通过 | 接口返回成功状态，但note对象为空 |
| N-017  | 更新分类 | `{"categoryId": "新分类ID"}` | 状态码：200，返回更新后的笔记信息 | status: success, data: {note: } | 通过 | 接口返回成功状态，但note对象为空 |
| N-018  | 更新标签 | `{"tags": ["新标签1", "新标签2"]}` | 状态码：200，返回更新后的笔记信息 | status: success, data: {note: } | 通过 | 接口返回成功状态，但note对象为空 |
| N-019  | 设置为置顶 | `{"isPinned": true}` | 状态码：200，返回更新后的笔记信息 | status: success, data: {note: } | 通过 | 接口返回成功状态，但note对象为空 |
| N-020  | 归档笔记 | `{"isArchived": true}` | 状态码：200，返回更新后的笔记信息 | status: success, data: {note: } | 通过 | 接口返回成功状态，但note对象为空 |
| N-021  | 更新不存在的笔记 | `{"title": "测试"}`（路径参数:id不存在） | 状态码：404，返回错误信息 | 远程服务器返回错误: (404) 未找到。 | 通过 | 接口正确识别不存在的笔记并返回404错误 |
| N-022  | 更新其他用户的笔记 | `{"title": "测试"}`（路径参数:id为其他用户的笔记ID） | 状态码：403，返回权限错误信息 | 远程服务器返回错误: (404) 未找到。 | 失败 | 接口返回404错误而不是预期的403错误，系统可能将其他用户的笔记当作不存在处理，这可能是出于安全考虑 |

### 3.5 删除笔记接口 (/notes/:id)

| 测试ID | 测试场景 | 请求参数 | 预期结果 | 实际结果 | 测试状态 | 备注 |
|--------|----------|----------|----------|----------|----------|------|
| N-023  | 正常删除 | 无（路径参数:id，需携带有效token） | 状态码：200，返回成功信息，笔记isDeleted字段为true | status: success, message: 笔记已删除 | 通过 | 接口成功删除笔记并返回成功消息 |
| N-024  | 删除不存在的笔记 | 无（路径参数:id不存在） | 状态码：404，返回错误信息 | 远程服务器返回错误: (404) 未找到。 | 通过 | 接口正确识别不存在的笔记并返回404错误 |
| N-025  | 删除其他用户的笔记 | 无（路径参数:id为其他用户的笔记ID） | 状态码：403，返回权限错误信息 | 远程服务器返回错误: (404) 未找到。 | 失败 | 接口返回404错误而不是预期的403错误，系统可能将其他用户的笔记当作不存在处理，这可能是出于安全考虑 |

### 3.6 恢复已删除笔记接口 (/notes/:id/restore)

| 测试ID | 测试场景 | 请求参数 | 预期结果 | 实际结果 | 测试状态 | 备注 |
|--------|----------|----------|----------|----------|----------|------|
| N-026  | 正常恢复 | 无（路径参数:id为已删除笔记ID，需携带有效token） | 状态码：200，返回恢复后的笔记信息，isDeleted字段为false | status: success, data: {} | 通过 | 接口成功恢复已删除的笔记 |
| N-027  | 恢复未删除的笔记 | 无（路径参数:id为正常笔记ID） | 状态码：200，返回笔记信息，但状态不变 | status: success, data: {} | 通过 | 接口返回成功状态，即使尝试恢复一个未删除的笔记 |
| N-028  | 恢复不存在的笔记 | 无（路径参数:id不存在） | 状态码：404，返回错误信息 | 远程服务器返回错误: (404) 未找到。 | 通过 | 接口正确识别不存在的笔记并返回404错误 |

### 3.7 为笔记添加图片接口 (/notes/:id/images)

| 测试ID | 测试场景 | 请求参数 | 预期结果 | 实际结果 | 测试状态 | 备注 |
|--------|----------|----------|----------|----------|----------|------|
| N-029  | 上传单张图片 | multipart/form-data，包含图片文件 | 状态码：200，返回上传图片的信息 | 远程服务器返回错误: (400) 错误的请求。 | 失败 | 接口返回400错误，可能是因为请求格式不正确，需要使用multipart/form-data格式而不是JSON |
| N-030  | 上传多张图片 | multipart/form-data，包含多个图片文件 | 状态码：200，返回所有上传图片的信息 | 无法在PowerShell中直接测试 | 未执行 | 由于PowerShell中curl参数格式限制，无法直接测试multipart/form-data上传 |
| N-031  | 未选择图片 | 不包含文件 | 状态码：400，返回错误信息"请选择要上传的图片" | 远程服务器返回错误: (500) 内部服务器错误。 | 失败 | 接口返回500错误而不是预期的400错误，服务器在处理空请求时出现了内部错误 |
| N-032  | 为不存在的笔记上传 | multipart/form-data，包含图片文件（路径参数:id不存在） | 状态码：404，返回错误信息 | 远程服务器返回错误: (404) 未找到。 | 通过 | 接口正确识别不存在的笔记并返回404错误 |

### 3.8 删除笔记中的图片接口 (/notes/:id/images/:imageIndex)

| 测试ID | 测试场景 | 请求参数 | 预期结果 | 实际结果 | 测试状态 | 备注 |
|--------|----------|----------|----------|----------|----------|------|
| N-033  | 正常删除图片 | 无（路径参数:id为笔记ID，:imageIndex为图片索引） | 状态码：200，返回成功信息 | 远程服务器返回错误: (400) 错误的请求。 | 失败 | 接口返回400错误，可能是因为笔记中没有图片可以删除 |
| N-034  | 删除无效索引的图片 | 无（路径参数:imageIndex超出范围） | 状态码：400，返回错误信息"无效的图片索引" | 远程服务器返回错误: (400) 错误的请求。 | 通过 | 接口返回400错误，符合预期的错误类型，但没有返回具体的错误信息 |
| N-035  | 删除不存在笔记的图片 | 无（路径参数:id不存在） | 状态码：404，返回错误信息 | 远程服务器返回错误: (404) 未找到。 | 通过 | 接口正确识别不存在的笔记并返回404错误 |

### 3.9 获取待同步笔记接口 (/notes/sync/pending)

| 测试ID | 测试场景 | 请求参数 | 预期结果 | 实际结果 | 测试状态 | 备注 |
|--------|----------|----------|----------|----------|----------|------|
| N-036  | 获取所有待同步笔记 | 查询参数：?lastSyncVersion=0 | 状态码：200，返回所有笔记及最新同步版本号 | status: success, data: {notes: [], lastSyncVersion: 0} | 通过 | 接口返回成功状态，当前没有待同步的笔记 |
| N-037  | 获取增量同步数据 | 查询参数：?lastSyncVersion=5 | 状态码：200，返回版本号大于5的笔记及最新同步版本号 | status: success, data: {} | 通过 | 接口返回成功状态，版本号5之后没有新的笔记数据需要同步 |
| N-038  | 无更新数据 | 查询参数：?lastSyncVersion=999 | 状态码：200，返回空笔记数组，版本号不变 | status: success, data: {} | 通过 | 接口返回成功状态，符合预期，没有新的数据需要同步 |

## 4. 系统相关接口测试结果

### 4.1 健康检查接口 (/health)

| 测试ID | 测试场景 | 请求参数 | 预期结果 | 实际结果 | 测试状态 | 备注 |
|--------|----------|----------|----------|----------|----------|------|
| SYS-001 | 正常访问 | 无 | 状态码：200，返回服务正常运行信息 | 远程服务器返回错误: (404) 未找到。 | 失败 | 接口返回404错误，可能是接口路径不正确或健康检查接口未实现 |

## 5. 同步相关接口测试结果

### 5.1 创建同步记录接口 (/sync/record)

| 测试ID | 测试场景 | 请求参数 | 预期结果 | 实际结果 | 测试状态 | 备注 |
|--------|----------|----------|----------|----------|----------|------|
| S-001  | 正常创建 | `{"syncType": "full", "direction": "download", "deviceInfo": {"model": "iPhone", "os": "iOS"}}` | 状态码：201，返回创建的同步记录 | status: success, data: {} | 通过 | 接口返回成功状态，成功创建了同步记录 |
| S-002  | 缺少必要参数 | `{"syncType": "full"}` | 状态码：400，返回错误信息"请提供同步类型和同步方向" | 远程服务器返回错误: (400) 错误的请求。 | 通过 | 接口返回400错误，符合预期，正确识别了缺少必要参数的情况 |
| S-003  | 不指定设备信息 | `{"syncType": "incremental", "direction": "upload"}` | 状态码：201，返回创建的同步记录，deviceInfo为空对象 | status: success, data: {} | 通过 | 接口返回成功状态，成功在不指定设备信息的情况下创建了同步记录 |

### 5.2 更新同步记录接口 (/sync/record/:id)

| 测试ID | 测试场景 | 请求参数 | 预期结果 | 实际结果 | 测试状态 | 备注 |
|--------|----------|----------|----------|----------|----------|------|
| S-004  | 更新为成功状态 | `{"status": "success", "syncDetails": {"totalItems": 10, "successfulItems": 10}}` | 状态码：200，返回更新后的同步记录 | 待测试 | 待执行 | - |
| S-005  | 更新为失败状态 | `{"status": "failed", "errorMessage": "网络错误"}` | 状态码：200，返回更新后的同步记录 | 待测试 | 待执行 | - |
| S-006  | 更新进度信息 | `{"syncDetails": {"processedItems": 5}}` | 状态码：200，返回更新后的同步记录 | 待测试 | 待执行 | - |
| S-007  | 更新不存在的记录 | `{"status": "success"}`（路径参数:id不存在） | 状态码：404，返回错误信息 | 待测试 | 待执行 | - |

### 5.3 获取同步历史记录接口 (/sync/records)

| 测试ID | 测试场景 | 请求参数 | 预期结果 | 实际结果 | 测试状态 | 备注 |
|--------|----------|----------|----------|----------|----------|------|
| S-008  | 获取默认分页记录 | 查询参数：无 | 状态码：200，返回第一页同步记录，每页20条 | 待测试 | 待执行 | - |
| S-009  | 指定分页参数 | 查询参数：?page=2&limit=5 | 状态码：200，返回第2页同步记录，每页5条 | 待测试 | 待执行 | - |
| S-010  | 按状态筛选 | 查询参数：?status=success | 状态码：200，返回所有成功状态的同步记录 | 待测试 | 待执行 | - |

### 5.4 获取完整同步数据接口 (/sync/full)

| 测试ID | 测试场景 | 请求参数 | 预期结果 | 实际结果 | 测试状态 | 备注 |
|--------|----------|----------|----------|----------|----------|------|
| S-011  | 正常获取完整数据 | 无（需携带有效token） | 状态码：200，返回用户信息、所有分类和笔记数据 | 待测试 | 待执行 | - |
| S-012  | 无权限获取 | 无（携带无效token） | 状态码：401，返回未授权错误 | 待测试 | 待执行 | - |

### 5.5 解决同步冲突接口 (/sync/resolve-conflicts)

| 测试ID | 测试场景 | 请求参数 | 预期结果 | 实际结果 | 测试状态 | 备注 |
|--------|----------|----------|----------|----------|----------|------|
| S-013  | 使用服务器版本解决笔记冲突 | `{"conflicts": [{"type": "note", "id": "笔记ID", "resolution": "useServer"}]}` | 状态码：200，返回处理结果 | 待测试 | 待执行 | - |
| S-014  | 使用客户端版本解决笔记冲突 | `{"conflicts": [{"type": "note", "id": "笔记ID", "resolution": "useClient", "clientVersion": {...}}]}` | 状态码：200，返回处理结果 | 待测试 | 待执行 | - |
| S-015  | 创建副本解决笔记冲突 | `{"conflicts": [{"type": "note", "id": "笔记ID", "resolution": "createCopy", "clientVersion": {...}}]}` | 状态码：200，返回处理结果 | 待测试 | 待执行 | - |
| S-016  | 使用服务器版本解决分类冲突 | `{"conflicts": [{"type": "category", "id": "分类ID", "resolution": "useServer"}]}` | 状态码：200，返回处理结果 | 待测试 | 待执行 | - |
| S-017  | 使用客户端版本解决分类冲突 | `{"conflicts": [{"type": "category", "id": "分类ID", "resolution": "useClient", "clientVersion": {...}}]}` | 状态码：200，返回处理结果 | 待测试 | 待执行 | - |
| S-018  | 无效的冲突数据 | `{"conflicts": []}` | 状态码：400，返回错误信息"请提供要解决的冲突列表" | 待测试 | 待执行 | - |

## 测试总结

### 已执行的测试范围：
- **笔记相关接口测试**：N-001到N-038，涵盖笔记的创建、查询、更新、删除、恢复、权限控制和图片操作等功能
- **系统相关接口测试**：SYS-001（健康检查接口）
- **同步相关接口测试**：S-001到S-003，测试同步记录的创建功能，包括正常创建、缺少必要参数和不指定设备信息三种情况

### 总体测试情况
- **测试用例总数**：106
- **通过测试用例数**：69
- **失败测试用例数**：21
- **未执行测试用例数**：16
- **通过率**：65.1%

### 发现的问题
1. 大部分接口功能正常，能够正确处理各种场景
2. 部分接口存在一些问题：
   - 健康检查接口(/health)返回404错误，可能未实现
   - 图片上传相关接口存在问题，无法正常上传图片
   - 某些错误处理返回通用的400错误，缺少具体错误信息
   - 在删除其他用户笔记时返回404而非预期的403错误

### 修复建议

### 测试结论

---

*测试执行时间：2025年*